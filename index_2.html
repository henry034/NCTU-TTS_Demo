<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>交通大學語音合成系統</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="text/javascript">
        function synthesis(){
            playBtn = document.getElementById('btn_syn');
            audio = document.getElementById('audio');
            
            playBtn.innerText = "準備中";
            playBtn.disabled = true;
            text = document.getElementById('tts-text').value;
            param = {
                "text":text
            }
            url="http://sl78.speech.cm.nctu.edu.tw:5000/tts2";
            fetch(url, {
                method: "POST",
                headers: {
                        'Content-Type': 'application/json'
                      },
                body: JSON.stringify(param)
            }).then(function(res) {
                playBtn.innerText="合成";
                blob = new Blob([res.value], {type: 'audio/wav'});
                burl = URL.createObjectURL(blob);
                audio.src = burl;
                audio.load();
                audio.onload = function(evt) {
                    URL.revokeObjectURL(burl);
                };
                audio.play();
                return res;
                })
              .then(function(json) {
                console.log(json);
                console.log(burl);
                });
            
            playBtn.disabled = false;
        }
    </script>
</head>
<body>
    <div>
        <div class="title">
            <span>交通大學語音合成系統</span>
        </div>
        <div class="demo_title">    
            <span>請輸入要合成的文本：</span>
        </div>
        <div class="demo_box">
            <textarea maxlength="200" class="tts-textarea" id="tts-text"></textarea>
        </div>
        <div class="demo_sr">語速
            <input type="range" min="3.3333" max="6.6667" step="0.03" value="5.26">
        </div>
        <div class="demo_control">
            <button onclick='synthesis()' id="btn_syn">合成</button>
        </div>
        <div class=demo_audio">
            <audio controls="controls" preload="none" id="audio">
            </audio>
        </div>
    </div>
</body>
</html>
